name: Linting and Testing
on:
  pull_request:
  push:
env:
  DATABASE_URL: sqlite://./db.sqlite3
  SECRET_KEY: ${{secrets.SECRET_KEY}}
  MODE_DEBUG: ${{secrets.MODE_DEBUG}}
  ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'
jobs:
 lint:
   runs-on: ubuntu-latest
   steps:
     - uses: actions/checkout@v3
     - uses: wizhi/setup-task@v1
     - uses: actions/setup-python@v4
       with:
          python-version: "3.11"
     - uses: Gr1N/setup-poetry@v8
     - run: poetry --version
     - run: poetry install
     - run: task runserver &
     - run: task code-lint
     - run: task runtest
